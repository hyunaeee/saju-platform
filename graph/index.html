<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¸ìƒì˜ íŒŒë™ - ì‚¬ì£¼ ì¸ìƒ ì¢…í•© ì˜ˆì–¸ì„œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Image Generation Library -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6906055503131628"
     crossorigin="anonymous"></script>

    <style>
        body {
            font-family: 'Noto Serif KR', serif;
            background-color: #1a1a1d;
            color: #e0e0e0;
        }
        .gold-text { color: #d4af37; }
        .gold-border { border-color: #d4af37; }
        .bg-gold { background-color: #d4af37; }
        .text-silver { color: #a0a0a0; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(212, 175, 55, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .glass-panel:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border-color: rgba(212, 175, 55, 0.5);
        }
        .input-field {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #4a4a4a;
            color: #fff;
            transition: all 0.3s ease;
        }
        .input-field:focus {
            border-color: #d4af37;
            outline: none;
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }
        .btn-submit {
            background: linear-gradient(135deg, #d4af37 0%, #aa8a2e 100%);
            color: #1a1a1d;
            transition: transform 0.2s;
        }
        .btn-submit:hover {
            transform: scale(1.02);
            filter: brightness(1.1);
        }
        .pillar-box {
            writing-mode: vertical-rl;
            text-orientation: upright;
            letter-spacing: 0.2em;
        }
        .timeline-dot {
            position: absolute;
            left: -9px;
            top: 6px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #d4af37;
            border: 3px solid #1a1a1d;
            z-index: 10;
        }
        /* Fade in animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a1d; }
        ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #d4af37; }

        .warning-box {
            background: rgba(255, 0, 0, 0.1);
            border-left: 3px solid #ef4444;
            padding: 10px;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #fca5a5;
        }

        /* Share Card Specific Styles (Hidden normally) */
        #shareCardContainer {
            position: fixed;
            left: -9999px;
            top: 0;
            width: 540px; /* Instagram Story Width ratio approx 9:16 high res */
            height: 960px;
            background: #1a1a1d;
            z-index: -1;
        }
        .share-card {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, #2a2a30 0%, #000000 100%);
            padding: 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            border: 12px double #d4af37;
            position: relative;
            box-sizing: border-box;
        }
        .share-card-inner {
            width: 100%;
            height: 100%;
            border: 1px solid rgba(212, 175, 55, 0.3);
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }
        .share-pattern {
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background-image: radial-gradient(#d4af37 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.05;
            pointer-events: none;
        }
        .share-type-badge {
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.2), transparent);
            border-top: 1px solid #d4af37;
            border-bottom: 1px solid #d4af37;
            color: #d4af37;
            padding: 8px 40px;
            font-weight: bold;
            font-size: 1.5rem;
            margin-bottom: 10px;
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

    <!-- Header -->
    <header class="text-center mb-10 fade-in">
        <h1 class="text-4xl md:text-5xl font-bold gold-text mb-2">ì¸ìƒì˜ íŒŒë™</h1>
        <p class="text-gray-400 text-sm md:text-base">ì‚¬ì£¼ ëª…ë¦¬í•™ ê¸°ë°˜ ì¸ìƒ ì¢…í•© ì˜ˆì–¸ì„œ</p>
    </header>

    <!-- Input Section -->
    <div id="inputSection" class="w-full max-w-lg glass-panel p-8 rounded-2xl shadow-2xl fade-in" style="animation-delay: 0.2s;">
        <div class="space-y-6">
            <div>
                <label class="block text-sm text-gray-400 mb-1">ì„±í•¨ (ì„ íƒ)</label>
                <input type="text" id="nameInput" placeholder="í™ê¸¸ë™" class="w-full p-3 rounded-lg input-field">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ì„±ë³„</label>
                    <select id="genderInput" class="w-full p-3 rounded-lg input-field appearance-none">
                        <option value="male">ë‚¨ì„± (ä¹¾å‘½)</option>
                        <option value="female">ì—¬ì„± (å¤å‘½)</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ì–‘ë ¥/ìŒë ¥</label>
                    <select id="calendarType" class="w-full p-3 rounded-lg input-field appearance-none">
                        <option value="solar">ì–‘ë ¥</option>
                        <option value="lunar" disabled>ìŒë ¥ (ì¤€ë¹„ì¤‘)</option>
                    </select>
                </div>
            </div>

            <div class="grid grid-cols-3 gap-2">
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ìƒë…„</label>
                    <input type="number" id="yearInput" placeholder="1990" class="w-full p-3 rounded-lg input-field">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ì›”</label>
                    <input type="number" id="monthInput" placeholder="1" min="1" max="12" class="w-full p-3 rounded-lg input-field">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-1">ì¼</label>
                    <input type="number" id="dayInput" placeholder="1" min="1" max="31" class="w-full p-3 rounded-lg input-field">
                </div>
            </div>

            <div>
                <label class="block text-sm text-gray-400 mb-1">íƒœì–´ë‚œ ì‹œê°„</label>
                <select id="timeInput" class="w-full p-3 rounded-lg input-field appearance-none">
                    <option value="-1">ì‹œê°„ ëª¨ë¦„ (ì‚¼ì£¼ë§Œ ë¶„ì„)</option>
                    <option value="0">ìì‹œ (23:30 ~ 01:29)</option>
                    <option value="2">ì¶•ì‹œ (01:30 ~ 03:29)</option>
                    <option value="4">ì¸ì‹œ (03:30 ~ 05:29)</option>
                    <option value="6">ë¬˜ì‹œ (05:30 ~ 07:29)</option>
                    <option value="8">ì§„ì‹œ (07:30 ~ 09:29)</option>
                    <option value="10">ì‚¬ì‹œ (09:30 ~ 11:29)</option>
                    <option value="12">ì˜¤ì‹œ (11:30 ~ 13:29)</option>
                    <option value="14">ë¯¸ì‹œ (13:30 ~ 15:29)</option>
                    <option value="16">ì‹ ì‹œ (15:30 ~ 17:29)</option>
                    <option value="18">ìœ ì‹œ (17:30 ~ 19:29)</option>
                    <option value="20">ìˆ ì‹œ (19:30 ~ 21:29)</option>
                    <option value="22">í•´ì‹œ (21:30 ~ 23:29)</option>
                </select>
            </div>

            <button onclick="analyzeDestiny()" class="w-full py-4 rounded-lg font-bold text-lg btn-submit shadow-lg mt-4">
                ì¢…í•© ì •ë°€ ë¶„ì„ ì‹œì‘
            </button>
        </div>
    </div>

    <!-- Result Section (Hidden by default) -->
    <div id="resultSection" class="hidden w-full max-w-5xl mt-10 space-y-8 pb-20">
        
        <!-- 1. Basic Info & Pillars -->
        <div class="glass-panel p-6 rounded-2xl fade-in text-center relative overflow-hidden">
             <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-[#d4af37] to-transparent"></div>
            <h2 class="text-2xl gold-text font-bold mb-2"><span id="resultName"></span>ë‹˜ì˜ ëª…ìš´(å‘½é‹)</h2>
            <p id="soulAnimal" class="text-gray-400 text-sm mb-6"></p>

            <div class="flex justify-center gap-4 md:gap-12">
                <!-- Pillars generated by JS -->
                <div class="flex flex-col items-center"><span class="text-gray-500 text-xs mb-1">ë§ë…„(æ™‚)</span><div class="w-14 h-28 md:w-16 md:h-36 border border-gray-700 rounded flex items-center justify-center bg-black/20"><span id="pillarTime" class="text-xl md:text-3xl font-bold pillar-box gold-text"></span></div></div>
                <div class="flex flex-col items-center relative"><span class="text-[#d4af37] text-xs mb-1 font-bold">ë³¸ì›(æ—¥)</span><div class="w-14 h-28 md:w-16 md:h-36 border-2 gold-border rounded flex items-center justify-center bg-black/30 shadow-[0_0_15px_rgba(212,175,55,0.3)] transform scale-105"><span id="pillarDay" class="text-xl md:text-3xl font-bold pillar-box gold-text"></span></div></div>
                <div class="flex flex-col items-center"><span class="text-gray-500 text-xs mb-1">ì²­ë…„(æœˆ)</span><div class="w-14 h-28 md:w-16 md:h-36 border border-gray-700 rounded flex items-center justify-center bg-black/20"><span id="pillarMonth" class="text-xl md:text-3xl font-bold pillar-box gold-text"></span></div></div>
                <div class="flex flex-col items-center"><span class="text-gray-500 text-xs mb-1">ì´ˆë…„(å¹´)</span><div class="w-14 h-28 md:w-16 md:h-36 border border-gray-700 rounded flex items-center justify-center bg-black/20"><span id="pillarYear" class="text-xl md:text-3xl font-bold pillar-box gold-text"></span></div></div>
            </div>
            
            <!-- Element Balance (Mini) -->
            <div class="mt-6 flex justify-center gap-4 text-xs text-gray-400">
                <span id="balanceText"></span>
            </div>
        </div>

        <!-- 2. Innate Nature (Born Characteristics) -->
        <div class="glass-panel p-6 rounded-2xl fade-in bg-gradient-to-r from-gray-900 to-[#1a1a1d] border-l-4 border-l-[#d4af37]">
            <h3 class="text-xl gold-text font-bold mb-4">ğŸŒŸ íƒ€ê³ ë‚œ ë³¸ì„± (Innate Nature)</h3>
            <p id="innateNatureTitle" class="text-white font-bold text-lg mb-2"></p>
            <p id="innateNatureDesc" class="text-gray-300 leading-relaxed text-sm md:text-base mb-4"></p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="bg-black/30 p-3 rounded">
                    <span class="text-[#d4af37] font-bold block mb-1">ğŸ‘ ì¥ì </span>
                    <p id="naturePros" class="text-sm text-gray-400"></p>
                </div>
                <div class="bg-black/30 p-3 rounded">
                    <span class="text-gray-400 font-bold block mb-1">ğŸ‘ ë‹¨ì  ë° ì£¼ì˜</span>
                    <p id="natureCons" class="text-sm text-gray-400"></p>
                </div>
            </div>
        </div>

        <!-- 3. Life Graph (Moved Up) -->
        <div class="glass-panel p-4 md:p-8 rounded-2xl fade-in relative">
            <h3 class="text-xl gold-text font-bold mb-4 ml-2">ğŸ“‰ ì¸ìƒ ì´ìš´ íë¦„ë„</h3>
            <div class="relative h-80 w-full">
                <canvas id="lifeChart"></canvas>
            </div>
            <p class="text-xs text-center text-gray-500 mt-2">ê·¸ë˜í”„ê°€ ë†’ì„ìˆ˜ë¡ ìš´ì˜ ê¸°ì„¸ê°€ ê°•í•˜ê³ , ë‚®ì„ìˆ˜ë¡ ë‚´ì‹¤ì„ ë‹¤ì ¸ì•¼ í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.</p>
        </div>

        <!-- 4. Critical Moments -->
        <div class="glass-panel p-6 rounded-2xl fade-in bg-gradient-to-br from-[#1a1a1d] to-[#25252b]">
            <h3 class="text-xl gold-text font-bold mb-6 text-center">âš¡ ì¸ìƒì˜ ê²°ì •ì  ìˆœê°„ (Critical Moments)</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                <div class="p-4 rounded-xl border border-yellow-500/30 bg-yellow-500/5 hover:bg-yellow-500/10 transition">
                    <div class="text-yellow-500 font-bold mb-1">ìµœê³ ì˜ ì „ì„±ê¸°</div>
                    <div class="text-3xl text-white font-bold mb-2"><span id="bestAge"></span>ì„¸</div>
                    <p id="bestDesc" class="text-xs text-gray-400 break-keep"></p>
                </div>
                <div class="p-4 rounded-xl border border-red-500/30 bg-red-500/5 hover:bg-red-500/10 transition">
                    <div class="text-red-400 font-bold mb-1">ê°€ì¥ ì£¼ì˜í•  ì‹œê¸°</div>
                    <div class="text-3xl text-white font-bold mb-2"><span id="worstAge"></span>ì„¸</div>
                    <p id="worstDesc" class="text-xs text-gray-400 break-keep"></p>
                </div>
                <div class="p-4 rounded-xl border border-green-500/30 bg-green-500/5 hover:bg-green-500/10 transition">
                    <div class="text-green-400 font-bold mb-1">ê±´ê°•/ì²´ë ¥ ê³ ë¹„</div>
                    <div class="text-3xl text-white font-bold mb-2"><span id="healthAge"></span>ì„¸</div>
                    <p id="healthDesc" class="text-xs text-gray-400 break-keep"></p>
                </div>
            </div>
        </div>

        <!-- 5. Thematic Future Predictions -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 fade-in">
            <!-- Wealth -->
            <div class="glass-panel p-6 rounded-2xl border-t-4 border-yellow-600">
                <h3 class="text-lg text-yellow-500 font-bold mb-3 flex items-center">ğŸ’° ì¬ë¬¼ìš´ ì‹¬ì¸µ ë¶„ì„</h3>
                <p id="wealthPred" class="text-gray-300 text-sm leading-relaxed mb-3"></p>
                <div class="warning-box">
                    <strong>âš ï¸ ì¬ë¬¼ ì†ì¬ìˆ˜ ê²½ê³ :</strong>
                    <p id="wealthWarn" class="mt-1"></p>
                </div>
                <div class="mt-3 p-3 bg-black/30 rounded text-xs text-yellow-200/70">
                    <strong>Tip:</strong> <span id="wealthTip"></span>
                </div>
            </div>
            <!-- Career -->
            <div class="glass-panel p-6 rounded-2xl border-t-4 border-blue-600">
                <h3 class="text-lg text-blue-400 font-bold mb-3 flex items-center">ğŸ† ì§ì—…/ëª…ì˜ˆìš´ ì‹¬ì¸µ ë¶„ì„</h3>
                <p id="careerPred" class="text-gray-300 text-sm leading-relaxed mb-3"></p>
                <div class="warning-box">
                    <strong>âš ï¸ ì‚¬íšŒìƒí™œ ìœ„ê¸° ê²½ê³ :</strong>
                    <p id="careerWarn" class="mt-1"></p>
                </div>
                <div class="mt-3 p-3 bg-black/30 rounded text-xs text-blue-200/70">
                    <strong>ì¶”ì²œ ì§ì—…:</strong> <span id="jobRec"></span>
                </div>
            </div>
            <!-- Love/Family -->
            <div class="glass-panel p-6 rounded-2xl border-t-4 border-pink-600">
                <h3 class="text-lg text-pink-400 font-bold mb-3 flex items-center">ğŸ’• ì• ì •/ê°€ì •ìš´ ì‹¬ì¸µ ë¶„ì„</h3>
                <p id="lovePred" class="text-gray-300 text-sm leading-relaxed mb-3"></p>
                <div class="warning-box">
                    <strong>âš ï¸ ì´ë³„/ê°ˆë“±ìˆ˜ ê²½ê³ :</strong>
                    <p id="loveWarn" class="mt-1"></p>
                </div>
            </div>
            <!-- Health (Specific) -->
            <div class="glass-panel p-6 rounded-2xl border-t-4 border-green-600">
                <h3 class="text-lg text-green-400 font-bold mb-3 flex items-center">ğŸŒ¿ ê±´ê°•ìš´ ë° ì·¨ì•½ì </h3>
                <p id="healthPred" class="text-gray-300 text-sm leading-relaxed mb-3"></p>
                <div class="warning-box">
                    <strong>âš ï¸ ì¹˜ëª…ì  ì•½ì  ê²½ê³ :</strong>
                    <p id="healthWarn" class="mt-1"></p>
                </div>
                <div class="mt-3 p-3 bg-black/30 rounded text-xs text-green-200/70">
                    <strong>ê´€ë¦¬ í•„ìˆ˜ ë¶€ìœ„:</strong> <span id="healthWeakness"></span>
                </div>
            </div>
        </div>

        <!-- 6. 10-Year Timeline Scenario -->
        <div class="glass-panel p-6 rounded-2xl fade-in">
            <h3 class="text-lg gold-text font-bold mb-6 border-b border-gray-700 pb-2">ğŸ“… 10ë…„ ë‹¨ìœ„ ì¸ìƒ ì‹œë‚˜ë¦¬ì˜¤</h3>
            <div class="relative border-l-2 border-gray-700 ml-3 space-y-10 py-2" id="timelineContainer">
                <!-- Generated dynamically -->
            </div>
        </div>

        <!-- 7. Secret Data (Fun items) -->
        <div class="glass-panel p-6 rounded-2xl fade-in grid grid-cols-2 md:grid-cols-4 gap-4 text-center text-sm">
            <div>
                <span class="block text-gray-500 mb-1">ìˆ˜í˜¸ ë™ë¬¼</span>
                <span id="guardianAnimal" class="text-white font-bold"></span>
            </div>
            <div>
                <span class="block text-gray-500 mb-1">í–‰ìš´ ì»¬ëŸ¬</span>
                <div class="flex justify-center items-center gap-2">
                    <span id="luckyColorName" class="text-white font-bold"></span>
                    <div id="luckyColorBox" class="w-3 h-3 rounded-full"></div>
                </div>
            </div>
            <div>
                <span class="block text-gray-500 mb-1">í–‰ìš´ ìˆ«ì</span>
                <span id="luckyNumber" class="text-white font-bold"></span>
            </div>
            <div>
                <span class="block text-gray-500 mb-1">í–‰ìš´ ë°©í–¥</span>
                <span id="luckyDirection" class="text-white font-bold"></span>
            </div>
        </div>

        <!-- Footer Actions -->
        <div class="flex flex-col md:flex-row gap-4 justify-center items-center pb-10 mt-10">
            <button onclick="openShareModal()" class="px-8 py-3 rounded-full bg-gradient-to-r from-green-600 to-green-500 text-white font-bold shadow-lg hover:scale-105 transition-transform flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
                ìš´ëª… ì¹´ë“œ ì €ì¥ (ê³µìœ )
            </button>
            <button onclick="location.reload()" class="px-8 py-3 rounded-full border border-gray-600 text-gray-400 hover:text-white hover:border-white transition-colors">
                ë‹¤ë¥¸ ì‚¬ëŒë„ ë´ì£¼ê¸°
            </button>
        </div>
        <p class="text-xs text-center text-gray-600 opacity-50 pb-10">* ë³¸ ê²°ê³¼ëŠ” ëª…ë¦¬í•™ì  ì•Œê³ ë¦¬ì¦˜ì— ê¸°ë°˜í•œ ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.</p>

    </div>

    <!-- Hidden Share Card Layout (For html2canvas generation) -->
    <div id="shareCardContainer">
        <div class="share-card">
            <div class="share-pattern"></div>
            <div class="share-card-inner">
                <!-- Top: Header -->
                <div class="text-center w-full mt-4">
                    <div class="text-xs text-[#d4af37] tracking-[0.3em] font-bold mb-1">S A J U &nbsp; A N A L Y S I S</div>
                    <h1 class="text-2xl font-bold text-white mb-6">ì¸ìƒì˜ íŒŒë™</h1>
                    
                    <p class="text-gray-400 text-sm mb-1"><span id="shareName" class="text-white font-bold text-lg mr-1"></span>ë‹˜ì˜ ìš´ëª… ìœ í˜•</p>
                </div>

                <!-- Middle: Type & Graph -->
                <div class="w-full flex flex-col items-center flex-grow justify-center">
                    <div id="shareType" class="share-type-badge text-center">ëŒ€ê¸°ë§Œì„±í˜•</div>
                    
                    <!-- Graph Image -->
                    <div class="w-full h-64 bg-black/40 rounded-xl p-4 border border-gray-700 shadow-2xl relative mb-6">
                        <img id="shareGraphImg" class="w-full h-full object-contain" />
                        <div class="absolute bottom-2 left-0 right-0 text-center text-[10px] text-gray-500">LIFE LUCK FLOW (0~100ì„¸)</div>
                    </div>

                    <!-- 4 Key Stats Grid -->
                    <div class="grid grid-cols-2 gap-4 w-full px-2">
                        <div class="bg-gradient-to-br from-gray-800 to-black p-4 rounded-lg border border-gray-700 flex flex-col items-center">
                            <span class="text-2xl mb-1">ğŸ†</span>
                            <div class="text-[10px] text-gray-400 uppercase">Best Age</div>
                            <div class="text-xl text-[#d4af37] font-bold"><span id="shareBest"></span>ì„¸</div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-800 to-black p-4 rounded-lg border border-gray-700 flex flex-col items-center">
                            <span class="text-2xl mb-1">âš ï¸</span>
                            <div class="text-[10px] text-gray-400 uppercase">Caution</div>
                            <div class="text-xl text-red-400 font-bold"><span id="shareWorst"></span>ì„¸</div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-800 to-black p-4 rounded-lg border border-gray-700 flex flex-col items-center">
                            <span class="text-2xl mb-1">ğŸ¾</span>
                            <div class="text-[10px] text-gray-400 uppercase">Guardian</div>
                            <div class="text-sm text-white font-bold mt-1" id="shareAnimal"></div>
                        </div>
                        <div class="bg-gradient-to-br from-gray-800 to-black p-4 rounded-lg border border-gray-700 flex flex-col items-center">
                            <span class="text-2xl mb-1">ğŸ€</span>
                            <div class="text-[10px] text-gray-400 uppercase">Lucky Color</div>
                            <div class="text-sm text-white font-bold mt-1" id="shareColor"></div>
                        </div>
                    </div>
                </div>

                <!-- Bottom: Footer -->
                <div class="text-center w-full mt-6 mb-2">
                    <p class="text-[10px] text-gray-600">DESIGNED BY LIFE WAVE</p>
                    <div class="text-[9px] text-gray-700 mt-1">@your_destiny_graph</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center flex-col">
        <div class="w-12 h-12 border-4 border-[#d4af37] border-t-transparent rounded-full animate-spin mb-4"></div>
        <p class="text-[#d4af37]">ê³ í’ˆì§ˆ ìš´ëª… ì¹´ë“œ ì¸í™” ì¤‘...</p>
    </div>

    <script>
        // --- Saju Constants ---
        const CHEONGAN = ['ê°‘(ç”²)', 'ì„(ä¹™)', 'ë³‘(ä¸™)', 'ì •(ä¸)', 'ë¬´(æˆŠ)', 'ê¸°(å·±)', 'ê²½(åºš)', 'ì‹ (è¾›)', 'ì„(å£¬)', 'ê³„(ç™¸)'];
        const JIJI = ['ì(å­)', 'ì¶•(ä¸‘)', 'ì¸(å¯…)', 'ë¬˜(å¯)', 'ì§„(è¾°)', 'ì‚¬(å·³)', 'ì˜¤(åˆ)', 'ë¯¸(æœª)', 'ì‹ (ç”³)', 'ìœ (é…‰)', 'ìˆ (æˆŒ)', 'í•´(äº¥)'];
        const ANIMALS = ['ì¥', 'ì†Œ', 'í˜¸ë‘ì´', 'í† ë¼', 'ìš©', 'ë±€', 'ë§', 'ì–‘', 'ì›ìˆ­ì´', 'ë‹­', 'ê°œ', 'ë¼ì§€'];
        const COLOR_MAP = { 'ëª©': 'ë¸”ë£¨/ê·¸ë¦°', 'í™”': 'ë ˆë“œ/í•‘í¬', 'í† ': 'ì˜ë¡œìš°/ë¸Œë¼ìš´', 'ê¸ˆ': 'í™”ì´íŠ¸/ì‹¤ë²„', 'ìˆ˜': 'ë¸”ë™/í¼í”Œ' };
        const COLOR_HEX = { 'ëª©': '#4ade80', 'í™”': '#f87171', 'í† ': '#facc15', 'ê¸ˆ': '#e5e7eb', 'ìˆ˜': '#818cf8' };
        const NUMBER_MAP = { 'ëª©': '3, 8', 'í™”': '2, 7', 'í† ': '5, 10', 'ê¸ˆ': '4, 9', 'ìˆ˜': '1, 6' };
        const DIRECTION_MAP = { 'ëª©': 'ë™ìª½', 'í™”': 'ë‚¨ìª½', 'í† ': 'ì¤‘ì•™', 'ê¸ˆ': 'ì„œìª½', 'ìˆ˜': 'ë¶ìª½' };

        // Element Map
        const ELEMENT_MAP = {
            'ç”²': 'ëª©', 'ä¹™': 'ëª©', 'ä¸™': 'í™”', 'ä¸': 'í™”', 'æˆŠ': 'í† ', 'å·±': 'í† ', 'åºš': 'ê¸ˆ', 'è¾›': 'ê¸ˆ', 'å£¬': 'ìˆ˜', 'ç™¸': 'ìˆ˜',
            'å¯…': 'ëª©', 'å¯': 'ëª©', 'å·³': 'í™”', 'åˆ': 'í™”', 'è¾°': 'í† ', 'æˆŒ': 'í† ', 'ä¸‘': 'í† ', 'æœª': 'í† ', 'ç”³': 'ê¸ˆ', 'é…‰': 'ê¸ˆ', 'äº¥': 'ìˆ˜', 'å­': 'ìˆ˜'
        };

        let chartInstance = null;

        // --- Helper Functions ---
        function getGanjiYear(year) {
            const stemIndex = (year - 4) % 10;
            const branchIndex = (year - 4) % 12;
            return { stem: CHEONGAN[stemIndex], branch: JIJI[branchIndex], stemIdx: stemIndex, branchIdx: branchIndex };
        }

        function getGanjiMonth(yearStemIdx, month) {
            const startStemMap = [2, 4, 6, 8, 0, 2, 4, 6, 8, 0]; 
            let stemStart = startStemMap[yearStemIdx];
            let monthBranchIdx = (month + 12 - 2) % 12; 
            if (month === 1) monthBranchIdx = 11; 
            let stemIdx = (stemStart + monthBranchIdx) % 10;
            const monthBranches = [2,3,4,5,6,7,8,9,10,11,0,1]; 
            let finalBranchIdx = monthBranches[(month - 1 + 12) % 12]; 
            if(month === 1) finalBranchIdx = 1; 
            return { stem: CHEONGAN[stemIdx], branch: JIJI[finalBranchIdx], stemIdx: stemIdx, branchIdx: finalBranchIdx };
        }

        function getGanjiDay(year, month, day) {
            const baseDate = new Date(1900, 0, 1);
            const targetDate = new Date(year, month - 1, day);
            const diffTime = Math.abs(targetDate - baseDate);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const stemIdx = (0 + diffDays) % 10;
            const branchIdx = (10 + diffDays) % 12;
            return { stem: CHEONGAN[stemIdx], branch: JIJI[branchIdx], stemIdx: stemIdx, branchIdx: branchIdx };
        }

        function getGanjiTime(dayStemIdx, hour) {
            const startStemMap = [0, 2, 4, 6, 8, 0, 2, 4, 6, 8];
            const startStem = startStemMap[dayStemIdx];
            let branchIdx = 0;
            if (hour >= 23 || hour < 1) branchIdx = 0;
            else branchIdx = Math.floor((hour + 1) / 2) % 12;
            const stemIdx = (startStem + branchIdx) % 10;
            return { stem: CHEONGAN[stemIdx], branch: JIJI[branchIdx], stemIdx: stemIdx, branchIdx: branchIdx };
        }

        function getElement(char) {
            const cleanChar = char.replace(/[^\u4e00-\u9fa5]/g, ''); 
            return ELEMENT_MAP[cleanChar] || 'Unknown';
        }

        function countElements(pillars) {
            const counts = { 'ëª©': 0, 'í™”': 0, 'í† ': 0, 'ê¸ˆ': 0, 'ìˆ˜': 0 };
            pillars.forEach(p => {
                if(p) {
                    const stemHanja = p.stem.match(/[\u4e00-\u9fa5]/)[0];
                    const branchHanja = p.branch.match(/[\u4e00-\u9fa5]/)[0];
                    counts[ELEMENT_MAP[stemHanja]]++;
                    counts[ELEMENT_MAP[branchHanja]]++;
                }
            });
            return counts;
        }

        // --- Main Analysis Function ---
        function analyzeDestiny() {
            const name = document.getElementById('nameInput').value || 'ë°©ë¬¸ì';
            const year = parseInt(document.getElementById('yearInput').value);
            const month = parseInt(document.getElementById('monthInput').value);
            const day = parseInt(document.getElementById('dayInput').value);
            const hour = parseInt(document.getElementById('timeInput').value);
            
            if (!year || !month || !day) {
                alert("ìƒë…„ì›”ì¼ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // 1. Calculate Pillars
            const yearPillar = getGanjiYear(year);
            const monthPillar = getGanjiMonth(yearPillar.stemIdx, month);
            const dayPillar = getGanjiDay(year, month, day);
            let timePillar = (hour === -1) ? null : getGanjiTime(dayPillar.stemIdx, hour);

            // 2. UI Update (Pillars)
            document.getElementById('resultName').innerText = name;
            
            const setPillarText = (id, pillar, isUnknown) => {
                const el = document.getElementById(id);
                if (isUnknown) {
                    el.innerHTML = '<span class="text-sm text-gray-500">ë¯¸ìƒ<br>(æœªè©³)</span>';
                    el.classList.add('text-gray-500');
                } else {
                    el.innerHTML = pillar.stem.split('(')[1].replace(')','') + "<br>" + pillar.branch.split('(')[1].replace(')','');
                    el.classList.remove('text-gray-500');
                }
            };

            setPillarText('pillarYear', yearPillar, false);
            setPillarText('pillarMonth', monthPillar, false);
            setPillarText('pillarDay', dayPillar, false);
            setPillarText('pillarTime', timePillar, !timePillar);

            // 3. Five Elements & Secret Data
            const allPillars = [yearPillar, monthPillar, dayPillar, timePillar];
            const counts = countElements(allPillars);
            
            // Generate Data
            const seed = year + month * 100 + day * 10000 + (hour === -1 ? 0 : hour);
            const lifeData = generateLifeCurve(seed);
            
            // Execute Updates
            updateSecretData(dayPillar, counts);
            generateInnateNature(dayPillar, counts); // New Section
            renderChart(lifeData);
            generateThematicPredictions(dayPillar, counts, lifeData);
            generateTimelineAndCriticalMoments(dayPillar, lifeData);

            // Prepare Share Data (Hidden)
            document.getElementById('shareName').innerText = name;
            
            // Show UI
            document.getElementById('inputSection').style.display = 'none';
            const resultSection = document.getElementById('resultSection');
            resultSection.classList.remove('hidden');
            resultSection.scrollIntoView({ behavior: 'smooth' });
        }

        // --- Content Generators ---

        function updateSecretData(dayPillar, counts) {
            // Guardian Animal
            const branchChar = dayPillar.branch.match(/[\u4e00-\u9fa5]/)[0];
            const branchIdx = JIJI.findIndex(j => j.includes(branchChar));
            const animal = ANIMALS[branchIdx];
            
            // Stem Color
            const stemChar = dayPillar.stem.match(/[\u4e00-\u9fa5]/)[0];
            const stemElement = ELEMENT_MAP[stemChar];
            let auraColor = "";
            if(stemElement === 'ëª©') auraColor = "ì²­(é‘)";
            else if(stemElement === 'í™”') auraColor = "ì (èµ¤)";
            else if(stemElement === 'í† ') auraColor = "í™©(é»ƒ)";
            else if(stemElement === 'ê¸ˆ') auraColor = "ë°±(ç™½)";
            else auraColor = "í‘(é»‘)";

            const fullAnimal = `${auraColor}ìƒ‰ ${animal}`;
            document.getElementById('guardianAnimal').innerText = fullAnimal;
            document.getElementById('soulAnimal').innerText = `ë‹¹ì‹ ì˜ ì˜í˜¼ì„ ìƒì§•í•˜ëŠ” ë™ë¬¼ì€ '${fullAnimal}'ì…ë‹ˆë‹¤.`;
            document.getElementById('shareAnimal').innerText = fullAnimal;

            // Lucky Item (Lacking Element)
            let luckyEl = 'ëª©';
            let minCount = 100;
            for(const [el, count] of Object.entries(counts)) {
                if(count < minCount) { minCount = count; luckyEl = el; }
            }
            
            const luckyColor = COLOR_MAP[luckyEl];
            document.getElementById('luckyColorName').innerText = luckyColor;
            document.getElementById('shareColor').innerText = luckyColor;
            document.getElementById('luckyColorBox').style.backgroundColor = COLOR_HEX[luckyEl];
            document.getElementById('luckyNumber').innerText = NUMBER_MAP[luckyEl];
            document.getElementById('luckyDirection').innerText = DIRECTION_MAP[luckyEl];

            // Balance Text
            document.getElementById('balanceText').innerText = `ë¶€ì¡±í•œ ê¸°ìš´: ${luckyEl} | ê³¼í•œ ê¸°ìš´: ${Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b)}`;
        }

        function generateInnateNature(dayPillar, counts) {
            const myStem = dayPillar.stem.match(/[\u4e00-\u9fa5]/)[0];
            
            let title = "";
            let desc = "";
            let pros = "";
            let cons = "";

            switch(myStem) {
                case 'ç”²': // ëª©(ì–‘)
                    title = "ê³§ê²Œ ë»—ì€ ëŒ€ë“¤ë³´, ê±°ëª©(å·¨æœ¨)";
                    desc = "ë‹¹ì‹ ì€ ìˆ²ì†ì˜ í° ë‚˜ë¬´ì™€ ê°™ìŠµë‹ˆë‹¤. êµ½íˆê¸° ì‹«ì–´í•˜ê³  ìœ„ë¡œ ë»—ì–´ë‚˜ê°€ë ¤ëŠ” ìƒìŠ¹ ìš•êµ¬ê°€ ê°•í•©ë‹ˆë‹¤. ë¦¬ë”ì‹­ì´ íƒì›”í•˜ê³  ì‹œì‘í•˜ëŠ” í˜ì´ ì¢‹ìœ¼ë‚˜, í•œë²ˆ ë¶€ëŸ¬ì§€ë©´ íšŒë³µí•˜ëŠ” ë° ì‹œê°„ì´ ê±¸ë¦½ë‹ˆë‹¤. ë‚¨ì˜ ë°‘ì— ìˆê¸°ë³´ë‹¤ëŠ” ìš°ë‘ë¨¸ë¦¬ê°€ ë˜ì–´ì•¼ ì§ì„±ì´ í’€ë¦¬ëŠ” ëŒ€ì¥ë¶€ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.";
                    pros = "ì¶”ì§„ë ¥, ë¦¬ë”ì‹­, ì¸ìí•¨, ê¸ì •ì ì¸ ì‚¬ê³ ";
                    cons = "ê³ ì§‘ì´ ì…ˆ, ìœµí†µì„± ë¶€ì¡±, ì¢Œì ˆ ì‹œ íšŒë³µì´ ë”ë”¤";
                    break;
                case 'ä¹™': // ëª©(ìŒ)
                    title = "ëˆì§ˆê¸´ ìƒëª…ë ¥, ë©êµ´ ì‹ë¬¼(í™”ì´ˆ)";
                    desc = "ë‹¹ì‹ ì€ í™˜ê²½ ì ì‘ë ¥ì´ ë›°ì–´ë‚œ ë©êµ´ê³¼ ê°™ìŠµë‹ˆë‹¤. ê²‰ìœ¼ë¡œëŠ” ìœ í•´ ë³´ì´ì§€ë§Œ ë‚´ë©´ì˜ ê³ ì§‘ê³¼ ìƒì¡´ ë³¸ëŠ¥ì€ íƒ€ì˜ ì¶”ì¢…ì„ ë¶ˆí—ˆí•©ë‹ˆë‹¤. ë°”ëŒì´ ë¶ˆë©´ ëˆ•ì§€ë§Œ ë‹¤ì‹œ ì¼ì–´ë‚˜ëŠ” ìœ ì—°í•¨ì´ ìµœëŒ€ ë¬´ê¸°ì…ë‹ˆë‹¤. ì‚¬ëŒë“¤ê³¼ ì–´ìš¸ë¦¬ê¸°ë¥¼ ì¢‹ì•„í•˜ê³  í˜„ì‹¤ì ì¸ ì´ìµì„ ì˜ ì±™ê¹ë‹ˆë‹¤.";
                    pros = "ìœ ì—°í•¨, ê°•í•œ ìƒì¡´ë ¥, ì‚¬êµì„±, í˜„ì‹¤ ê°ê°";
                    cons = "ì˜ì¡´ì  ì„±í–¥, ì§ˆíˆ¬ì‹¬, ë³€ë•ìŠ¤ëŸ¬ì›€";
                    break;
                case 'ä¸™': // í™”(ì–‘)
                    title = "ì„¸ìƒì„ ë¹„ì¶”ëŠ” íƒœì–‘(å¤ªé™½)";
                    desc = "ë‹¹ì‹ ì€ í•˜ëŠ˜ì— ë–  ìˆëŠ” íƒœì–‘ì²˜ëŸ¼ ë°ê³  ì—´ì •ì ì…ë‹ˆë‹¤. ìˆ¨ê¸°ëŠ” ê²ƒ ì—†ì´ ì†”ì§í•˜ê³  ë’¤ëì´ ì—†ìœ¼ë©°, ë§Œì¸ì˜ ì£¼ëª©ì„ ë°›ì•„ì•¼ ì—ë„ˆì§€ê°€ ì†ŸìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ë„ˆë¬´ ëœ¨ê±°ìš°ë©´ ì£¼ë³€ì„ ë©”ë§ˆë¥´ê²Œ í•  ìˆ˜ ìˆìœ¼ë‹ˆ ê°ì • ì¡°ì ˆì´ í•„ìš”í•©ë‹ˆë‹¤. ì„±ê²©ì´ ê¸‰í•˜ì§€ë§Œ ì˜ˆì˜ë¥¼ ì¤‘ì‹œí•©ë‹ˆë‹¤.";
                    pros = "ì—´ì •, ì†”ì§í•¨, ì˜ˆì˜ ë°”ë¦„, ì¹´ë¦¬ìŠ¤ë§ˆ";
                    cons = "ì„±ê²© ê¸‰í•¨, ê³¼ì‹œìš•, ê°ì • ê¸°ë³µ, í—ˆì„¸";
                    break;
                case 'ä¸': // í™”(ìŒ)
                    title = "ì€ì€í•œ ì´›ë¶ˆ, ë³„ë¹›";
                    desc = "ë‹¹ì‹ ì€ ì–´ë‘ ì„ ë°íˆëŠ” ì´›ë¶ˆì²˜ëŸ¼ ë”°ëœ»í•˜ê³  í—Œì‹ ì ì…ë‹ˆë‹¤. ê²‰ìœ¼ë¡œëŠ” ì¡°ìš©í•´ ë³´ì´ì§€ë§Œ ë‚´ë©´ì— ì—„ì²­ë‚œ ì—´ì •ê³¼ ì§‘ë…ì„ ìˆ¨ê¸°ê³  ìˆìŠµë‹ˆë‹¤. ì„¬ì„¸í•˜ê³  ê°ìˆ˜ì„±ì´ í’ë¶€í•˜ë©°, í•œ ê°€ì§€ ì¼ì— ëª°ë‘í•˜ëŠ” ì§‘ì¤‘ë ¥ì´ ë›°ì–´ë‚©ë‹ˆë‹¤. ë‹¤ë§Œ ì†ìœ¼ë¡œ í™”ë¥¼ ì‚­ì´ë‹¤ í­ë°œí•˜ë©´ ë¬´ì„­ìŠµë‹ˆë‹¤.";
                    pros = "ì§‘ì¤‘ë ¥, ë´‰ì‚¬ ì •ì‹ , ì„¬ì„¸í•¨, ë”°ëœ»í•¨";
                    cons = "ì˜ˆë¯¼í•¨, ì˜ì‹¬, ë‚´ë©´ì˜ ë¶„ë…¸, ì†Œì‹¬í•¨";
                    break;
                case 'æˆŠ': // í† (ì–‘)
                    title = "ë„“ê³  ì›…ì¥í•œ íƒœì‚°(æ³°å±±)";
                    desc = "ë‹¹ì‹ ì€ í° ì‚°ì²˜ëŸ¼ ë¬µì§í•˜ê³  ë¯¿ìŒì§ìŠ¤ëŸ½ìŠµë‹ˆë‹¤. í¬ìš©ë ¥ì´ ìˆì–´ ì‚¬ëŒë“¤ì´ ëª¨ì—¬ë“¤ê³  ì¤‘ì¬ì ì—­í• ì„ ì˜ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì‹ ìš©ì„ ëª©ìˆ¨ì²˜ëŸ¼ ì—¬ê¸°ë©° í–‰ë™ì´ ì§„ì¤‘í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ í•œë²ˆ ê³ ì§‘ì„ ë¶€ë¦¬ë©´ ëˆ„êµ¬ë„ êº¾ì„ ìˆ˜ ì—†ê³ , ë³€í™”ë¥¼ ì‹«ì–´í•´ ë‘”í•´ ë³´ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    pros = "ì‹ ìš©, í¬ìš©ë ¥, ë“¬ì§í•¨, ì¤‘ìš©";
                    cons = "ë¬´ëšëší•¨, ìœµí†µì„± ì—†ìŒ, ê²Œìœ¼ë¦„, ê³ ì§‘";
                    break;
                case 'å·±': // í† (ìŒ)
                    title = "ë¹„ì˜¥í•œ í…ƒë°­, ëŒ€ì§€";
                    desc = "ë‹¹ì‹ ì€ ë§Œë¬¼ì„ ê¸¸ëŸ¬ë‚´ëŠ” ë°­ í™ì²˜ëŸ¼ ì‹¤ì† ìˆê³  ìì• ë¡­ìŠµë‹ˆë‹¤. ìê¸° ì†ì„ ì˜ ë“œëŸ¬ë‚´ì§€ ì•Šìœ¼ë©´ì„œë„ ì‹¤ë¦¬ë¥¼ ì±™ê¸°ëŠ” ëŠ¥ë ¥ì´ íƒì›”í•©ë‹ˆë‹¤. ë‹¤ì¬ë‹¤ëŠ¥í•˜ê³  í™˜ê²½ì— ì˜ ë§ì¶”ì§€ë§Œ, ì˜ì‹¬ì´ ë§ì•„ ê²°ì •ì ì¸ ìˆœê°„ì— ë§ì„¤ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    pros = "ì‹¤ì†, ë‹¤ì¬ë‹¤ëŠ¥, ì ì‘ë ¥, ì˜¨í™”í•¨";
                    cons = "ì˜ì‹¬, ìš°ìœ ë¶€ë‹¨, ì†ì„ ì•Œ ìˆ˜ ì—†ìŒ";
                    break;
                case 'åºš': // ê¸ˆ(ì–‘)
                    title = "ë‹¤ë“¬ì–´ì§€ì§€ ì•Šì€ ì›ì„, ë¬´ì‡ ";
                    desc = "ë‹¹ì‹ ì€ ë°”ìœ„ë‚˜ ê°•ì² ì²˜ëŸ¼ ë‹¨ë‹¨í•˜ê³  ê²°ë‹¨ë ¥ì´ ìˆìŠµë‹ˆë‹¤. ì˜ë¦¬ë¥¼ ì¤‘ì‹œí•˜ê³  ë§ºê³  ëŠìŒì´ í™•ì‹¤í•˜ì—¬ í˜ëª…ê°€ì ì¸ ê¸°ì§ˆì´ ìˆìŠµë‹ˆë‹¤. ë¶ˆì˜ë¥¼ ë³´ë©´ ì°¸ì§€ ëª»í•˜ë©° ì¶”ì§„ë ¥ì´ ê°•í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë„ˆë¬´ ê°•í•˜ë©´ ë¶€ëŸ¬ì§€ê¸° ì‰½ê³ , ë‚¨ì—ê²Œ ìƒì²˜ë¥¼ ì£¼ëŠ” ë§ì„ ë¬´ì‹¬ì½” í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                    pros = "ê²°ë‹¨ë ¥, ì˜ë¦¬, ì¶”ì§„ë ¥, ê³µì •í•¨";
                    cons = "ë…ì„ ì , ì°¨ê°€ì›€, íƒ€ì¸ì„ ë¬´ì‹œí•¨";
                    break;
                case 'è¾›': // ê¸ˆ(ìŒ)
                    title = "ë¹›ë‚˜ëŠ” ë³´ì„, ë‚ ì¹´ë¡œìš´ ì¹¼";
                    desc = "ë‹¹ì‹ ì€ ì œë ¨ëœ ë³´ì„ì²˜ëŸ¼ ì„¬ì„¸í•˜ê³  ì˜ˆë¦¬í•©ë‹ˆë‹¤. ìì¡´ì‹¬ì´ ë§¤ìš° ê°•í•˜ê³  ê¹”ë”í•œ ê²ƒì„ ì¢‹ì•„í•˜ë©° ë¯¸ì  ê°ê°ì´ ìˆìŠµë‹ˆë‹¤. ëƒ‰ì² í•œ ë¹„íŒ ëŠ¥ë ¥ì´ ìˆì–´ ì •í™•í•˜ì§€ë§Œ, ì˜ˆë¯¼í•œ ì„±ê²© íƒ“ì— ìŠ¤ìŠ¤ë¡œ ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë§ì´ ë°›ìŠµë‹ˆë‹¤. ì‘ì§€ë§Œ ì•„ì£¼ ë§¤ìš´ ê³ ì¶”ì™€ ê°™ìŠµë‹ˆë‹¤.";
                    pros = "ì„¬ì„¸í•¨, ì •í™•ì„±, ê¹”ë”í•¨, ë¯¸ì  ê°ê°";
                    cons = "ê¹Œì¹ í•¨, ëƒ‰ì†Œì , ê°•í•œ ìì¡´ì‹¬, ì´ê¸°ì ";
                    break;
                case 'å£¬': // ìˆ˜(ì–‘)
                    title = "ë„ë„í•˜ê²Œ íë¥´ëŠ” ê°•ë¬¼, ë°”ë‹¤";
                    desc = "ë‹¹ì‹ ì€ ê¹Šì€ ë°”ë‹¤ì²˜ëŸ¼ ì§€í˜œë¡­ê³  ìœ ì—°í•©ë‹ˆë‹¤. ì´ëª…í•˜ì—¬ ë¨¸ë¦¬ íšŒì „ì´ ë¹ ë¥´ê³  ì„ê¸°ì‘ë³€ì— ëŠ¥í•©ë‹ˆë‹¤. í¬ìš©ë ¥ì´ ì»¤ì„œ ëª¨ë“  ê²ƒì„ ë°›ì•„ë“¤ì´ì§€ë§Œ, ì†ë§ˆìŒì„ ì•Œê¸° ì–´ë µê³  í•œë²ˆ í™”ê°€ ë‚˜ë©´ ì“°ë‚˜ë¯¸ì²˜ëŸ¼ ëŒë³€í•©ë‹ˆë‹¤. ììœ ë¡œìš´ ì˜í˜¼ì´ë¼ êµ¬ì†ë°›ëŠ” ê²ƒì„ ì‹«ì–´í•©ë‹ˆë‹¤.";
                    pros = "ì§€í˜œ, ìœ ì—°í•¨, í¬ìš©ë ¥, ì°½ì˜ì„±";
                    cons = "ìŒí‰í•¨, ë³€ë•, ìƒ‰ì •(è‰²æƒ…) ì£¼ì˜, ë°©ë‘ë²½";
                    break;
                case 'ç™¸': // ìˆ˜(ìŒ)
                    title = "ì´‰ì´‰í•œ ë‹¨ë¹„, ì‹œëƒ‡ë¬¼";
                    desc = "ë‹¹ì‹ ì€ ë§Œë¬¼ì„ ì ì…”ì£¼ëŠ” ë´„ë¹„ì²˜ëŸ¼ ì—¬ë¦¬ê³  ë‹¤ì •ë‹¤ê°í•©ë‹ˆë‹¤. ê°ìˆ˜ì„±ì´ í’ë¶€í•˜ê³  ê¸°íšë ¥ì´ ë›°ì–´ë‚˜ë©°, ì¡°ìš©íˆ ìŠ¤ë©°ë“¤ì–´ ì‚¬ëŒì˜ ë§ˆìŒì„ ì–»ìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ìƒê°ì´ ë„ˆë¬´ ë§ì•„ ì‹¤í–‰ë ¥ì´ ë¶€ì¡±í•  ìˆ˜ ìˆê³ , ì˜ˆë¯¼í•˜ì—¬ ìƒì²˜ë¥¼ ì˜ ë°›ìŠµë‹ˆë‹¤.";
                    pros = "ê¸°íšë ¥, ë‹¤ì •í•¨, ì„¬ì„¸í•¨, ì´ëª…í•¨";
                    cons = "ì‹¤í–‰ë ¥ ë¶€ì¡±, ìš°ìš¸ê°, ì˜ˆë¯¼í•¨, ì”ë¨¸ë¦¬";
                    break;
                default:
                    title = "ì‹ ë¹„ë¡œìš´ ìš°ì£¼ì˜ ê¸°ìš´";
                    desc = "ì˜¤í–‰ì˜ ì¡°í™”ê°€ ë…íŠ¹í•˜ì—¬ í•œë§ˆë””ë¡œ ì •ì˜í•˜ê¸° ì–´ë ¤ìš´ ë³µí•©ì ì¸ ë§¤ë ¥ì„ ì§€ë…”ìŠµë‹ˆë‹¤.";
                    pros = "ë‹¤ì–‘í•œ ê°€ëŠ¥ì„±";
                    cons = "ì •ì²´ì„± í˜¼ë€ ì£¼ì˜";
            }

            document.getElementById('innateNatureTitle').innerText = title;
            document.getElementById('innateNatureDesc').innerText = desc;
            document.getElementById('naturePros').innerText = pros;
            document.getElementById('natureCons').innerText = cons;
        }

        function generateThematicPredictions(dayPillar, counts, data) {
            const myEl = getElement(dayPillar.stem.slice(-2));
            
            // Logic setup (same as before but text expanded)
            let wealthEl = '';
            if(myEl === 'ëª©') wealthEl = 'í† ';
            else if(myEl === 'í™”') wealthEl = 'ê¸ˆ';
            else if(myEl === 'í† ') wealthEl = 'ìˆ˜';
            else if(myEl === 'ê¸ˆ') wealthEl = 'ëª©';
            else wealthEl = 'í™”';

            const wealthCount = counts[wealthEl];
            let wealthMsg = "";
            let wealthWarn = "";
            let wealthTip = "";

            if(wealthCount === 0) {
                wealthMsg = "ì‚¬ì£¼ ì›êµ­ì— ì¬ë¬¼(ëˆ) ê¸€ìê°€ ë³´ì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ì´ëŠ” 'ë¬´ì¬ì‚¬ì£¼'ë¼ í•˜ì—¬, ëˆì„ ì¢‡ì•„ë‹¤ë‹ˆë©´ ì˜¤íˆë ¤ ëˆì´ ë„ë§ê°€ëŠ” í˜•êµ­ì…ë‹ˆë‹¤. ì‚¬ì—…ë³´ë‹¤ëŠ” ìê²©ì¦ì´ë‚˜ ì „ë¬¸ ê¸°ìˆ ì„ í†µí•œ ì†Œë“ì´ í›¨ì”¬ ì•ˆì •ì ì…ë‹ˆë‹¤. í˜„ê¸ˆì„ ì†ì— ì¥ê³  ìˆìœ¼ë©´ ì“¸ ì¼ì´ ìƒê²¨ ë‚˜ê°€ë²„ë¦¬ë‹ˆ, ë“¤ì–´ì˜¤ëŠ” ì¦‰ì‹œ ë¬¸ì„œ(ë¶€ë™ì‚°, ì£¼ì‹, ë³´í—˜) í˜•íƒœë¡œ ë°”ê¾¸ì–´ ë¬¶ì–´ë‘ëŠ” ê²ƒì´ ìœ ì¼í•œ í•´ë²•ì…ë‹ˆë‹¤.";
                wealthWarn = "ì§€ì¸ê³¼ì˜ ê¸ˆì „ ê±°ë˜ëŠ” 100% ì†ì‹¤ë¡œ ì´ì–´ì§‘ë‹ˆë‹¤. ë³´ì¦ì€ ë¬¼ë¡ ì´ê³  ëˆì„ ë¹Œë ¤ì£¼ëŠ” ê²ƒë„ ê·¸ëƒ¥ ì¤€ë‹¤ê³  ìƒê°í•´ì•¼ í•©ë‹ˆë‹¤.";
                wealthTip = "ì§€ê°‘ì„ ì—´ê¸°ë³´ë‹¤ í†µì¥ì„ ë¬¶ìœ¼ì„¸ìš”. í˜„ê¸ˆ ìœ ë™ì„±ì„ ì¤„ì´ëŠ” ê²ƒì´ ë‹µì…ë‹ˆë‹¤.";
            } else if(wealthCount >= 3) {
                wealthMsg = "ì‚¬ì£¼ì— ì¬ë¬¼ì˜ ê¸°ìš´ì´ ë„ˆë¬´ ê°•í•©ë‹ˆë‹¤(ì¬ë‹¤ì‹ ì•½). ì£¼ë³€ì— ëˆì´ ë  ë§Œí•œ ê¸°íšŒëŠ” ë§ê³ , ëˆì„ ë²„ëŠ” ì¬ì£¼ë„ ë¹„ìƒí•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ë‚´ ê·¸ë¦‡ë³´ë‹¤ ë‹´ì•„ì•¼ í•  ëˆì´ ë§ì•„ ê·¸ ë¬´ê²Œë¥¼ ê°ë‹¹í•˜ê¸° ë²„ê±°ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í°ëˆì„ ë²Œë©´ ëª¸ì´ ì•„í”„ê±°ë‚˜ ê°€ì •ì— ë¶ˆí™”ê°€ ìƒê¸¸ ìˆ˜ ìˆëŠ” ì–‘ë©´ì„±ì´ ìˆìŠµë‹ˆë‹¤.";
                wealthWarn = "ìš•ì‹¬ì„ ë¶€ë ¤ ë¬´ë¦¬í•˜ê²Œ ì‚¬ì—…ì„ í™•ì¥í•˜ë©´ í•œìˆœê°„ì— ëª¨ë“  ê²ƒì„ ìƒì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ì„± ë¬¸ì œë¡œ ì¸í•œ ì¬ì‚° ì†ì‹¤ì„ ê°ë³„íˆ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.";
                wealthTip = "ëˆì„ ë²„ëŠ” ê²ƒë³´ë‹¤ 'ì§€í‚¤ëŠ” ì‹œìŠ¤í…œ'ì„ ë§Œë“œëŠ” ë° ì§‘ì¤‘í•˜ì„¸ìš”.";
            } else {
                wealthMsg = "ì¬ë¬¼ì˜ ê¸°ìš´ì´ ì ì ˆíˆ ì¡°í™”ë¥¼ ì´ë£¨ê³  ìˆì–´ ê°€ì¥ ì´ìƒì ì…ë‹ˆë‹¤. ì¼í™•ì²œê¸ˆë³´ë‹¤ëŠ” ì„±ì‹¤í•˜ê²Œ ì¼í•œ ë§Œí¼ ì°¨ê³¡ì°¨ê³¡ ì¬ì‚°ì´ ë¶ˆì–´ë‚˜ëŠ” 'ì •ì¬'ì˜ ì„±í–¥ì´ ê°•í•©ë‹ˆë‹¤. ê²½ì œ ê´€ë…ì´ íˆ¬ì² í•˜ì—¬ í—ˆíˆ¬ë£¨ ëˆì„ ì“°ì§€ ì•Šìœ¼ë©°, ì¤‘ë…„ ì´í›„ì—ëŠ” ê²½ì œì  ììœ ë¥¼ ëˆ„ë¦´ ìˆ˜ ìˆëŠ” íƒ„íƒ„í•œ ê¸°ë°˜ì´ ë§ˆë ¨ë©ë‹ˆë‹¤.";
                wealthWarn = "ë„ˆë¬´ ì•ˆì •ì ì¸ ê²ƒë§Œ ì¶”êµ¬í•˜ë‹¤ê°€ ì¢‹ì€ íˆ¬ì íƒ€ì´ë°ì„ ë†“ì¹  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë•Œë¡œëŠ” ê³¼ê°í•œ ê²°ë‹¨ì´ ìì‚°ì„ ì í”„ì—… ì‹œì¼œì¤ë‹ˆë‹¤.";
                wealthTip = "ì¥ê¸°ì ì¸ ì•ˆëª©ì˜ íˆ¬ìê°€ ëŒ€ì„±ê³µì„ ê±°ë‘¡ë‹ˆë‹¤.";
            }
            document.getElementById('wealthPred').innerText = wealthMsg;
            document.getElementById('wealthWarn').innerText = wealthWarn;
            document.getElementById('wealthTip').innerText = wealthTip;

            // Career
            let careerEl = '';
            if(myEl === 'ëª©') careerEl = 'ê¸ˆ';
            else if(myEl === 'í™”') careerEl = 'ìˆ˜';
            else if(myEl === 'í† ') careerEl = 'ëª©';
            else if(myEl === 'ê¸ˆ') careerEl = 'í™”';
            else careerEl = 'í† ';

            let jobRec = "";
            let careerMsg = "";
            let careerWarn = "";
            
            const dominantEl = Object.keys(counts).reduce((a, b) => counts[a] > counts[b] ? a : b);
            
            if(dominantEl === 'ëª©') jobRec = "êµìœ¡, ì¶œíŒ, ê¸°íš, ëª©ì¬/ê±´ì¶•, íŒ¨ì…˜, ì¸ë¬¸í•™";
            else if(dominantEl === 'í™”') jobRec = "ë°©ì†¡, IT/ì»´í“¨í„°, ì˜ˆìˆ , ìš”ë¦¬, ì˜ì—…, ì „ê¸°ì „ì";
            else if(dominantEl === 'í† ') jobRec = "ë¶€ë™ì‚°, ì¤‘ê°œì—…, ì¢…êµ, ë†ì—…, ì»¨ì„¤íŒ…, í† ëª©";
            else if(dominantEl === 'ê¸ˆ') jobRec = "ê¸ˆìœµ, ì˜ë£Œ(ì™¸ê³¼), êµ°ì¸/ê²½ì°°, ê³µí•™, ë°˜ë„ì²´";
            else jobRec = "ë¬´ì—­, ìœ í†µ, ì—°êµ¬ì›, ë°ì´í„°ë¶„ì„, ì„œë¹„ìŠ¤ì—…, ìˆ™ë°•ì—…";

            if(counts[careerEl] > 0) {
                careerMsg = "ì¡°ì§ ìƒí™œì— ì í•©í•œ 'ê´€ìš´'ì´ ëšœë ·í•©ë‹ˆë‹¤. ì²´ê³„ì ì¸ ì‹œìŠ¤í…œê³¼ ê·œì¹™ì´ ìˆëŠ” ê³³ì—ì„œ ëŠ¥ë ¥ì„ ë°œíœ˜í•˜ë©°, ìŠ¹ì§„ê³¼ ëª…ì˜ˆë¥¼ ì¤‘ìš”ì‹œí•©ë‹ˆë‹¤. ë¦¬ë”ì‹­ê³¼ ì±…ì„ê°ì´ ê°•í•´ ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ ì¡°ì§ ë‚´ì—ì„œ ì¸ì •ë°›ê³  ë†’ì€ ìœ„ì¹˜ì— ì˜¤ë¥¼ ìš´ëª…ì…ë‹ˆë‹¤.";
                careerWarn = "ìì¡´ì‹¬ì´ ë„ˆë¬´ ê°•í•´ ìƒì‚¬ì™€ì˜ ë§ˆì°°ì´ ìˆì„ ìˆ˜ ìˆê±°ë‚˜, ë°˜ëŒ€ë¡œ ë„ˆë¬´ ê¶Œìœ„ì ìœ¼ë¡œ ë³€í•´ ì•„ë«ì‚¬ëŒì˜ ì›ë§ì„ ì‚´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ìœµí†µì„±ì´ í•„ìš”í•©ë‹ˆë‹¤.";
            } else {
                careerMsg = "í‹€ì— ë°•íŒ ì¡°ì§ ìƒí™œë³´ë‹¤ëŠ” ììœ ë¡œìš´ ì˜í˜¼ì˜ ì†Œìœ ìì…ë‹ˆë‹¤. ê°„ì„­ë°›ê¸°ë¥¼ ê·¹ë„ë¡œ ì‹«ì–´í•˜ë©°, ë³¸ì¸ì˜ ìŠ¤ì¼€ì¤„ì„ ìŠ¤ìŠ¤ë¡œ í†µì œí•  ìˆ˜ ìˆëŠ” ì „ë¬¸ì§, í”„ë¦¬ëœì„œ, í˜¹ì€ ì°½ì—…ì´ í›¨ì”¬ ìœ ë¦¬í•©ë‹ˆë‹¤. ì°½ì˜ì ì´ê³  ë…ì°½ì ì¸ ì•„ì´ë””ì–´ë¡œ ìŠ¹ë¶€í•´ì•¼ í•©ë‹ˆë‹¤.";
                careerWarn = "ì¡°ì§ ìƒí™œì„ ì–µì§€ë¡œ í•˜ë©´ í™”ë³‘ì´ ë‚˜ê±°ë‚˜ ì´ì§ì´ ì¦ì•„ ê²½ë ¥ì´ ë‹¨ì ˆë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. 'ì›”ê¸‰ìŸì´' ë§ˆì¸ë“œë¡œëŠ” ì„±ê³µí•˜ê¸° í˜ë“­ë‹ˆë‹¤.";
            }
            document.getElementById('careerPred').innerText = careerMsg;
            document.getElementById('careerWarn').innerText = careerWarn;
            document.getElementById('jobRec').innerText = jobRec;

            // Love
            let loveMsg = "";
            let loveWarn = "";
            if (counts[wealthEl] > 0 || counts[careerEl] > 0) {
                loveMsg = "ì´ì„±ì—ê²Œ ì–´í•„í•˜ëŠ” ë§¤ë ¥ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë°œì‚°ë˜ëŠ” ì‚¬ì£¼ì…ë‹ˆë‹¤. ë„í™”ì‚´ì´ë‚˜ í™ì—¼ì‚´ì˜ ê¸°ìš´ì´ ìˆì„ ìˆ˜ ìˆì–´ ì£¼ë³€ì— ì‚¬ëŒì´ ëŠì´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê²°í˜¼ ìš´ë„ ë¹„êµì  ìˆœíƒ„í•˜ë©°, ë°°ìš°ìì˜ ë•ì„ ë³´ê±°ë‚˜ ê²°í˜¼ í›„ ì•ˆì •ì„ ì°¾ëŠ” ê²½ìš°ê°€ ë§ìŠµë‹ˆë‹¤.";
                loveWarn = "ì´ì„± ë¬¸ì œê°€ ë³µì¡í•´ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì–´ì¥ê´€ë¦¬ë¥¼ í•˜ê±°ë‚˜ ìš°ìœ ë¶€ë‹¨í•˜ê²Œ í–‰ë™í•˜ë‹¤ê°€ëŠ” ë§ì‹ ì‚´ì´ ë»—ì¹  ìˆ˜ ìˆìœ¼ë‹ˆ ë§ºê³  ëŠìŒì„ í™•ì‹¤íˆ í•´ì•¼ í•©ë‹ˆë‹¤.";
            } else {
                loveMsg = "ì¸ì—°ì´ ì‰½ê²Œ ë‹¿ì§€ ì•Šê±°ë‚˜, ë³¸ì¸ì´ ì´ì„±ì—ê²Œ í° ê´€ì‹¬ì´ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í™”ë ¤í•œ ì—°ì• ë³´ë‹¤ëŠ” ì¹œêµ¬ì²˜ëŸ¼ í¸ì•ˆí•œ ê´€ê³„ë¥¼ ì„ í˜¸í•©ë‹ˆë‹¤. ì†Œê°œíŒ…ë³´ë‹¤ëŠ” ì·¨ë¯¸ ìƒí™œ, ë™í˜¸íšŒ, ìŠ¤í„°ë”” ë“± ìì—°ìŠ¤ëŸ¬ìš´ ë§Œë‚¨ì—ì„œ ì§„êµ­ì¸ ì‚¬ëŒì„ ë§Œë‚  í™•ë¥ ì´ ë†’ìŠµë‹ˆë‹¤.";
                loveWarn = "ê³ ë…ì„ ì¦ê¸°ë‹¤ ëª»í•´ ê³ ë¦½ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í‘œí˜„ì„ í•˜ì§€ ì•Šìœ¼ë©´ ìƒëŒ€ë°©ì€ ëª¨ë¦…ë‹ˆë‹¤. ì—°ì•  ì„¸í¬ê°€ ë§ë¼ë²„ë¦¬ê¸° ì „ì— ì ê·¹ì ì¸ ë…¸ë ¥ì´ í•„ìš”í•©ë‹ˆë‹¤.";
            }
            document.getElementById('lovePred').innerText = loveMsg;
            document.getElementById('loveWarn').innerText = loveWarn;

            // Health
            let weakEl = 'ëª©';
            let minC = 100;
            for(const [el, count] of Object.entries(counts)) {
                if(count < minC) { minC = count; weakEl = el; }
            }
            
            let healthMsg = "";
            let weakPart = "";
            let healthWarn = "";

            if(weakEl === 'ëª©') { 
                weakPart = "ê°„, ë‹´, ì‹ ê²½ê³„, ê´€ì ˆ, ê°‘ìƒì„ "; 
                healthMsg = "ëª© ê¸°ìš´ì´ ì•½í•˜ë©´ í•´ë… ëŠ¥ë ¥ì´ ë–¨ì–´ì ¸ í”¼ë¡œê°€ ì‰½ê²Œ ìŒ“ì…ë‹ˆë‹¤. ê·¼ìœ¡ ê²½ë ¨ì´ë‚˜ ëˆˆì˜ í”¼ë¡œë¥¼ ìì£¼ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                healthWarn = "ìŒì£¼ì™€ ìŠ¤íŠ¸ë ˆìŠ¤ëŠ” ì¥ì•½ì…ë‹ˆë‹¤. íŠ¹íˆ ë¶„ë…¸ë¥¼ ì°¸ìœ¼ë©´ ê°„ì´ ìƒí•˜ë‹ˆ ì ì ˆí•œ í•´ì†Œë²•ì„ ì°¾ì•„ì•¼ í•©ë‹ˆë‹¤.";
            } else if(weakEl === 'í™”') { 
                weakPart = "ì‹¬ì¥, í˜ˆê´€, ì†Œì¥, ì‹œë ¥"; 
                healthMsg = "í™” ê¸°ìš´ì´ ì•½í•˜ë©´ í˜ˆì•¡ìˆœí™˜ì´ ì›í™œí•˜ì§€ ì•Šê³  ì†ë°œì´ ì°° ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¬ë¦¬ì ìœ¼ë¡œ ìœ„ì¶•ë˜ê±°ë‚˜ ìš°ìš¸ê°ì´ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                healthWarn = "í˜ˆì•• ê´€ë¦¬ì™€ ì‹¬í˜ˆê´€ ì§ˆí™˜ì— ìœ ì˜í•˜ì„¸ìš”. ê²¨ìš¸ì²  ê¸‰ê²©í•œ ì˜¨ë„ ë³€í™”ë¥¼ íŠ¹íˆ ì¡°ì‹¬í•´ì•¼ í•©ë‹ˆë‹¤.";
            } else if(weakEl === 'í† ') { 
                weakPart = "ìœ„ì¥, ì†Œí™”ê¸°, í”¼ë¶€, í—ˆë¦¬"; 
                healthMsg = "í†  ê¸°ìš´ì´ ì•½í•˜ë©´ ì†Œí™” í¡ìˆ˜ë ¥ì´ ë–¨ì–´ì ¸ ì•„ë¬´ë¦¬ ì˜ ë¨¹ì–´ë„ ì‚´ì´ ì•ˆ ì°Œê±°ë‚˜ ë°˜ëŒ€ë¡œ ì˜ ë¶“ìŠµë‹ˆë‹¤. ìœ„ì—¼ì„ ë‹¬ê³  ì‚´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                healthWarn = "ë¶ˆê·œì¹™í•œ ì‹ìŠµê´€ì€ ìœ„ì•” ë“±ì˜ í° ë³‘ì„ ë¶€ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¨ ìŒì‹ê³¼ ë°€ê°€ë£¨ë¥¼ ì¤„ì—¬ì•¼ í•©ë‹ˆë‹¤.";
            } else if(weakEl === 'ê¸ˆ') { 
                weakPart = "í, í˜¸í¡ê¸°, ëŒ€ì¥, ë¼ˆ, í”¼ë¶€"; 
                healthMsg = "ê¸ˆ ê¸°ìš´ì´ ì•½í•˜ë©´ ë©´ì—­ë ¥ì´ ë–¨ì–´ì ¸ ê°ê¸°ì— ìì£¼ ê±¸ë¦¬ê³  í”¼ë¶€ íŠ¸ëŸ¬ë¸”ì´ ì¦ìŠµë‹ˆë‹¤. ëŒ€ì¥ ê¸°ëŠ¥ì´ ì•½í•´ ì„¤ì‚¬ë‚˜ ë³€ë¹„ê°€ ì˜¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                healthWarn = "í¡ì—°ì€ ìì‚´í–‰ìœ„ì…ë‹ˆë‹¤. ë¯¸ì„¸ë¨¼ì§€ê°€ ì‹¬í•œ ë‚ ì€ ì™¸ì¶œì„ ì‚¼ê°€ê³ , ë“±ì‚°ìœ¼ë¡œ íí™œëŸ‰ì„ ëŠ˜ë ¤ì•¼ í•©ë‹ˆë‹¤.";
            } else { 
                weakPart = "ì‹ ì¥, ë°©ê´‘, ìƒì‹ê¸°, ê·€"; // ìˆ˜
                healthMsg = "ìˆ˜ ê¸°ìš´ì´ ì•½í•˜ë©´ ì •ë ¥ì´ ì•½í•˜ê±°ë‚˜ ì‚°ë¶€ì¸ê³¼/ë¹„ë‡¨ê¸°ê³¼ ê³„í†µì˜ ì§ˆí™˜ì— ì·¨ì•½í•©ë‹ˆë‹¤. ëª¸ì´ ì˜ ë¶“ê³  ëƒ‰ì¦ì´ ì‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.";
                healthWarn = "í•˜ì²´ë¥¼ ì°¨ê²Œ í•˜ë©´ ë§Œë³‘ì˜ ê·¼ì›ì´ ë©ë‹ˆë‹¤. ì§  ìŒì‹ì„ í”¼í•˜ê³  ë¬¼ì„ ìì£¼ ë§ˆì…” ì‹ ì¥ ê¸°ëŠ¥ì„ ë„ì™€ì•¼ í•©ë‹ˆë‹¤.";
            }

            document.getElementById('healthPred').innerText = healthMsg;
            document.getElementById('healthWeakness').innerText = weakPart;
            document.getElementById('healthWarn').innerText = healthWarn;
        }

        function generateLifeCurve(seed) {
            const dataPoints = [];
            let state = seed;
            const nextRand = () => {
                state = (state * 1664525 + 1013904223) % 4294967296;
                return state / 4294967296;
            };

            for (let age = 0; age <= 100; age += 5) {
                const frequency = 0.05 + (nextRand() * 0.02); 
                const phase = nextRand() * Math.PI * 2;
                let value = Math.sin(age * frequency + phase) * 30;
                const lifeStage = age < 20 ? 0.5 : (age < 50 ? 1.2 : (age < 80 ? 1.0 : 0.8));
                let score = 50 + (value * lifeStage);
                score += (nextRand() - 0.5) * 10;
                score = Math.max(10, Math.min(95, score));
                dataPoints.push(Math.round(score));
            }
            return dataPoints;
        }

        function renderChart(data) {
            const ctx = document.getElementById('lifeChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();

            const gradient = ctx.createLinearGradient(0, 0, 0, 400);
            gradient.addColorStop(0, 'rgba(212, 175, 55, 0.5)'); 
            gradient.addColorStop(1, 'rgba(212, 175, 55, 0.0)'); 

            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 21}, (_, i) => i * 5),
                    datasets: [{
                        label: 'ìš´ì„¸ íë¦„',
                        data: data,
                        borderColor: '#d4af37',
                        backgroundColor: gradient,
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#1a1a1d',
                        pointBorderColor: '#d4af37'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false, min: 0, max: 100 },
                        x: { grid: { display: false }, ticks: { color: '#666', maxTicksLimit: 10 } }
                    }
                }
            });
        }

        function generateTimelineAndCriticalMoments(dayPillar, data) {
            const timelineContainer = document.getElementById('timelineContainer');
            timelineContainer.innerHTML = ''; 

            let maxScore = -1, maxAge = 0;
            let minScore = 101, minAge = 0;
            let healthRiskAge = 0, healthRiskScore = 100;

            // 1. Identify Critical Ages
            data.forEach((score, index) => {
                const age = index * 5;
                if (score > maxScore) { maxScore = score; maxAge = age; }
                if (score < minScore) { minScore = score; minAge = age; }
                if (age >= 40 && score < healthRiskScore) { healthRiskScore = score; healthRiskAge = age; }
            });
            if (healthRiskAge === 0) healthRiskAge = minAge;

            // 2. Fill Critical Moments Cards
            document.getElementById('bestAge').innerText = maxAge;
            document.getElementById('bestDesc').innerText = "ì¸ìƒ ìµœê³ ì˜ í™©ê¸ˆê¸°. ëª…ì˜ˆì™€ ì¬ë¬¼ì´ í•¨ê»˜ ë”°ë¥´ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.";
            document.getElementById('shareBest').innerText = maxAge; 
            
            document.getElementById('worstAge').innerText = minAge;
            document.getElementById('worstDesc').innerText = "ì ì‹œ ë©ˆì¶°ê°€ëŠ” ì‹œê¸°. ë¬´ë¦¬í•œ íˆ¬ìë‚˜ í™•ì¥ì„ í”¼í•˜ê³  ë‚´ì‹¤ì„ ë‹¤ì§€ì„¸ìš”.";
            document.getElementById('shareWorst').innerText = minAge; // Added for share card

            document.getElementById('healthAge').innerText = healthRiskAge;
            document.getElementById('healthDesc').innerText = "ì—ë„ˆì§€ê°€ ê³ ê°ˆë˜ëŠ” ì‹œì . ê±´ê°• ê²€ì§„ê³¼ íœ´ì‹ì´ ë°˜ë“œì‹œ í•„ìš”í•©ë‹ˆë‹¤.";

            // 3. Generate Timeline
            const checkPoints = [20, 30, 40, 50, 60, 70]; 
            
            // Early life
            let score10 = (data[2] + data[3]) / 2;
            let earlyText = score10 > 60 ? "ì´ˆë…„ë¶€í„° ë‘ê°ì„ ë‚˜íƒ€ë‚´ë©° í•™ì—… ì„±ì·¨ê°€ ìš°ìˆ˜í•©ë‹ˆë‹¤." : "ëŒ€ê¸°ë§Œì„±í˜•ìœ¼ë¡œ, ì´ˆë°˜ì—ëŠ” ì§„ë¡œì— ëŒ€í•œ ê³ ë¯¼ê³¼ ë°©í™©ì´ ìˆì„ ìˆ˜ ìˆìœ¼ë‚˜ ì´ëŠ” í›—ë‚ ì˜ í° ìì–‘ë¶„ì´ ë©ë‹ˆë‹¤.";
            addTimelineItem("10ëŒ€", "ì´ˆë…„ì˜ íë¦„", earlyText, score10 > 60 ? 'rise' : 'flat');

            // Adult life
            checkPoints.forEach(age => {
                const idx = age / 5;
                const scoreNow = data[idx];
                const scorePrev = data[idx - 2];
                const diff = scoreNow - scorePrev;
                
                let title = "";
                let desc = "";
                let type = "flat";

                if (Math.abs(age - maxAge) <= 5) {
                    title = "ì¸ìƒì˜ ì ˆì •ê¸° (Highlight)";
                    desc = "ë‹¹ì‹ ì´ ê°€ì§„ ì ì¬ë ¥ì´ í­ë°œí•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ìŠ¹ì§„, ì‚¬ì—… ë²ˆì°½, ìì‚° ì¦ì‹ ë“± ê°€ì‹œì ì¸ ì„±ê³¼ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. í•˜ëŠ˜ì´ ë•ëŠ” ìš´ì„¸ì´ë‹ˆ ë§ì„¤ì´ì§€ ë§ê³  ë„ì „í•˜ì‹­ì‹œì˜¤.";
                    type = "peak";
                } else if (Math.abs(age - minAge) <= 5) {
                    title = "ì¸ë‚´ì™€ ìˆ˜ì„± (Caution)";
                    desc = "ë¹„ë°”ëŒì´ ë¶€ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ìƒˆë¡œìš´ ì¼ì„ ë²Œì´ê¸°ë³´ë‹¤ ê°€ì§„ ê²ƒì„ ì§€í‚¤ëŠ” ë° ì£¼ë ¥í•´ì•¼ í•©ë‹ˆë‹¤. ëŒ€ì¸ê´€ê³„ì—ì„œ ë°°ì‹ ìˆ˜ê°€ ìˆê±°ë‚˜ ê¸ˆì „ì  ì†ì‹¤ì´ ìš°ë ¤ë˜ë‹ˆ ëŒë‹¤ë¦¬ë„ ë‘ë“¤ê²¨ ë³´ê³  ê±´ë„ˆì„¸ìš”.";
                    type = "dip";
                } else if (diff > 15) {
                    title = "ìš´ìˆ˜ ëŒ€í†µì˜ ì„œë§‰";
                    desc = "ë§‰í˜”ë˜ ì¼ì´ í’€ë¦¬ê³  ê·€ì¸ì´ ì°¾ì•„ì˜µë‹ˆë‹¤. ì–´ë‘ìš´ í„°ë„ì„ ì§€ë‚˜ ë¹›ì„ ë³´ëŠ” í˜•êµ­ì´ë‹ˆ ì ê·¹ì ìœ¼ë¡œ ê¸°íšŒë¥¼ ì¡ìœ¼ì„¸ìš”.";
                    type = "rise";
                } else {
                    title = "í‰ì˜¨í•œ ì•ˆì •ê¸°";
                    desc = "í° êµ´ê³¡ ì—†ì´ ì¼ìƒì„ ì˜ìœ„í•˜ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤. ì†Œì†Œí•œ í–‰ë³µì„ ëˆ„ë¦¬ë©° ë‚´ì‹¤ì„ ê¸°í•˜ê¸° ì¢‹ìŠµë‹ˆë‹¤.";
                    type = "flat";
                }

                addTimelineItem(`${age}ëŒ€`, title, desc, type);
            });
            
            addTimelineItem("80ëŒ€ ì´í›„", "ì•ˆì‹ê³¼ ì¡´ê²½", "í›„í•™ë“¤ì—ê²Œ ì¡´ê²½ë°›ìœ¼ë©° í‰ì˜¨í•œ ë…¸í›„ë¥¼ ë³´ëƒ…ë‹ˆë‹¤. ì¸ìƒì˜ ì§€í˜œë¥¼ ë‚˜ëˆ„ë©° ë•ì„ ìŒ“ëŠ” ì‹œê¸°ì…ë‹ˆë‹¤.", "flat");

            function addTimelineItem(ageRange, title, desc, type) {
                const colors = {
                    'peak': 'text-yellow-500 border-yellow-500',
                    'rise': 'text-green-400 border-green-500',
                    'dip': 'text-red-400 border-red-500',
                    'flat': 'text-gray-400 border-gray-500'
                };
                const colorClass = colors[type] || colors['flat'];
                const dotColor = type === 'peak' ? 'bg-[#d4af37]' : (type === 'dip' ? 'bg-red-500' : (type === 'rise' ? 'bg-green-500' : 'bg-gray-600'));

                const html = `
                    <div class="relative pl-6">
                        <div class="timeline-dot ${dotColor} border-gray-800"></div>
                        <span class="text-xs ${colorClass.split(' ')[0]} font-bold block mb-1">${ageRange}</span>
                        <h4 class="text-lg font-bold text-white mb-1">${title}</h4>
                        <p class="text-sm text-gray-400">${desc}</p>
                    </div>
                `;
                timelineContainer.insertAdjacentHTML('beforeend', html);
            }
        }

        // --- Sharing Functions ---

        async function openShareModal() {
            document.getElementById('loadingOverlay').classList.remove('hidden');
            
            // 0. Calculate Life Type & Set Text
            const bestAge = parseInt(document.getElementById('shareBest').innerText);
            let lifeType = "";
            if (bestAge <= 25) lifeType = "ì´ˆë…„ ì„±ê³µí˜•";
            else if (bestAge <= 45) lifeType = "ì²­ë…„ í™œë™í˜•";
            else if (bestAge <= 60) lifeType = "ì¤‘ë…„ í™©ê¸ˆê¸°";
            else lifeType = "ëŒ€ê¸°ë§Œì„±í˜•";

            // If graph is very flat (simple heuristic check on best age score vs avg) - omitted for simplicity
            document.getElementById('shareType').innerText = lifeType;

            // 1. Prepare Share Card Chart
            // We need to render the chart into the hidden share card container as an image or canvas
            const mainChart = document.getElementById('lifeChart');
            const shareGraphImg = document.getElementById('shareGraphImg');
            shareGraphImg.src = mainChart.toDataURL(); // Copy chart state

            // 2. Wait a bit for DOM to settle
            setTimeout(async () => {
                const shareCard = document.querySelector('.share-card');
                
                try {
                    const canvas = await html2canvas(shareCard, {
                        backgroundColor: '#1a1a1d',
                        scale: 2 // High resolution
                    });

                    canvas.toBlob(async (blob) => {
                        const file = new File([blob], "lifewave_card.png", { type: "image/png" });
                        
                        // Try Web Share API (Mobile)
                        if (navigator.share && navigator.canShare && navigator.canShare({ files: [file] })) {
                            try {
                                await navigator.share({
                                    title: 'ì¸ìƒì˜ íŒŒë™ - ì‚¬ì£¼ ë¶„ì„ ê²°ê³¼',
                                    text: 'ë‚˜ì˜ ì¸ìƒ êµ´ê³¡ê³¼ í–‰ìš´ì˜ ì‹œê¸°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”.',
                                    files: [file]
                                });
                            } catch (err) {
                                console.log('Sharing failed', err);
                                // Fallback if share cancel or fail
                                saveAs(canvas.toDataURL(), "lifewave_card.png");
                            }
                        } else {
                            // Desktop Fallback
                            saveAs(canvas.toDataURL(), "lifewave_card.png");
                            alert("ì´ë¯¸ì§€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì¸ìŠ¤íƒ€ê·¸ë¨ ìŠ¤í† ë¦¬ë‚˜ ì¹´ì¹´ì˜¤í†¡ì— ì—…ë¡œë“œí•´ë³´ì„¸ìš”.");
                        }
                        
                        document.getElementById('loadingOverlay').classList.add('hidden');
                    });
                } catch (err) {
                    console.error("Image generation failed", err);
                    alert("ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
                    document.getElementById('loadingOverlay').classList.add('hidden');
                }
            }, 500);
        }

        function saveAs(uri, filename) {
            var link = document.createElement('a');
            if (typeof link.download === 'string') {
                link.href = uri;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                window.open(uri);
            }
        }
    </script>
</body>
</html>